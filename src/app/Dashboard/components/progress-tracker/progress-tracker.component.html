<div class="header">
  <div class="header__heading">
    <span class="header__title">{{ data.title ?? "Certification" }}</span>
    <span class="header__dates">{{ data.dates ?? "Date non définie" }}</span>
  </div>
  <div class="header__status">
    <span class="{{ 'status__title badge ' + data.status }} ">{{
      data.status[0].toUpperCase() + data.status.slice(1)
    }}</span>
  </div>
</div>
<div class="content">
  <div class="content__progress-bar">
    <div class="content__progess-bar-header">
      <span class="content__progess-bar-header-title">Progression</span>
      <span class="content__progess-bar-header-value"
        >{{ data.progression ?? 0 }}%</span
      >
    </div>
    <div class="content__progress-bar-content">
      <div
        class="content__progress"
        [style.width]="(data.progression ?? 0) + '%'"
      ></div>
    </div>
    <div class="content__progress-bar-footer">
      <span class="content__progress-bar-footer-text"
        >{{ data.certifiedUsers ?? 0 }} / {{ data.totalUsers ?? 0 }} comptes
        certifiés</span
      >
    </div>
  </div>
  <div class="content__global-progress">
    <span class="green"
      ><strong>{{ data.certifiedUsers ?? 0 }}</strong> Utilisateurs
      certifiés</span
    >
    <span class="pink"
      ><strong>{{
        (data.totalUsers ?? 0) - (data.certifiedUsers ?? 0)
      }}</strong>
      Utilisateurs non certifiés</span
    >
  </div>
</div>
<div class="footer">
  <button
    *HasPermission="'DETAILS_CAMPAGNE_DASHBOARD'"
    text="Voir les détails"
    class="generic-btn"
    variante="secondary outline"
    type="button"
    (click)="navigateToDetails()"
  ></button>
  <button
    *HasPermission="'EXPORTER_CAMPAGNE_DASHBOARD'"
    text="Exporter"
    class="generic-btn"
    variante="secondary"
    type="button"
    (click)="toggleActions($event)"
  >
    <div class="upload-icon"></div>
  </button>
</div>

<div class="actions-menu" #actions>
  <div
    *ngIf="!extractionInProcess; else loader"
    class="action-menu__action account-infos"
    (click)="
      exportExcel($event, {
        idCampaign: data.id,
        campaignName: data.title ? data.title : null
      })
    "
  >
    <div>
      <div *ngTemplateOutlet="sheetIcon"></div>
      <span>Rapport Excel</span>
    </div>
  </div>
  <div class="action-menu__action reset-password" (click)="exportPdf($event)">
    <div>
      <div *ngTemplateOutlet="statisticIcon"></div>
      <span>Rapport PDF</span>
    </div>
  </div>
</div>

<ng-template #sheetIcon>
  <svg
    width="24"
    height="25"
    viewBox="0 0 24 25"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g opacity="0.7">
      <path
        d="M8 18.5H16V16.5H8V18.5ZM8 14.5H16V12.5H8V14.5ZM6 22.5C5.45 22.5 4.97917 22.3042 4.5875 21.9125C4.19583 21.5208 4 21.05 4 20.5V4.5C4 3.95 4.19583 3.47917 4.5875 3.0875C4.97917 2.69583 5.45 2.5 6 2.5H14L20 8.5V20.5C20 21.05 19.8042 21.5208 19.4125 21.9125C19.0208 22.3042 18.55 22.5 18 22.5H6ZM13 9.5V4.5H6V20.5H18V9.5H13Z"
        fill="currentColor"
      />
    </g>
  </svg>
</ng-template>

<ng-template #statisticIcon>
  <svg
    width="24"
    height="25"
    viewBox="0 0 24 25"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g opacity="0.7">
      <path
        d="M2 21.5V19.5H22V21.5H2ZM3 18.5V11.5H6V18.5H3ZM8 18.5V6.5H11V18.5H8ZM13 18.5V9.5H16V18.5H13ZM18 18.5V3.5H21V18.5H18Z"
        fill="currentColor"
      />
    </g>
  </svg>
</ng-template>

<ng-template #loader>
  <div
    class="d-flex align-items-center justify-content-center"
    style="cursor: not-allowed; padding: 0.5rem; height: 41px"
  >
    <svg
      fill="#333"
      viewBox="0 0 24 24"
      width="24"
      height="24"
      style="vertical-align: middle"
      xmlns="http://www.w3.org/2000/svg"
    >
      <circle cx="4" cy="12" r="3" opacity="1">
        <animate
          id="spinner_qYjJ"
          begin="0;spinner_t4KZ.end-0.25s"
          attributeName="opacity"
          dur="0.75s"
          values="1;.2"
          fill="freeze"
        />
      </circle>
      <circle cx="12" cy="12" r="3" opacity=".4">
        <animate
          begin="spinner_qYjJ.begin+0.15s"
          attributeName="opacity"
          dur="0.75s"
          values="1;.2"
          fill="freeze"
        />
      </circle>
      <circle cx="20" cy="12" r="3" opacity=".3">
        <animate
          id="spinner_t4KZ"
          begin="spinner_qYjJ.begin+0.3s"
          attributeName="opacity"
          dur="0.75s"
          values="1;.2"
          fill="freeze"
        />
      </circle>
    </svg>
  </div>
</ng-template>
